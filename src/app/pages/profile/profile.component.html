<main>
    <section [ngClass]="modal == false ? 'container': 'editContainer'">
        <div class="infoPerfil">
            <div class="cardPerfil">

                <div class="nameContainer">
                    <p id="nameUser">{{user.name}}</p>
                </div>

                <img class="imgCard" [src]="user.marco" alt="">
                <img class="imgFondo" src="../../../assets/images/profile/fondoCarta.png" alt="">
                <img class="imgAvatar" [src]="user.photo" alt="">
                
                <div class="sobreMiContainer">
                    <p class="sobreMi">Criatura - humano</p>
                    <img class="iconSobreMi" src="../../../assets/images/iconos/humano.png" alt="">
                </div>
                
                <div class="infoUser">
                    <div class="email">
                        <p id="emailTitle">Correo Electrónico</p>
                        <p id="emailUser">{{user.email}}</p>
                    </div>
                    <hr class="line">
                    <div class="description">
                        <p id="descriptionTitle">Descripción</p>
                        <p id="descriptionUser">{{user.description}}</p>
                    </div>
                </div>

            </div>
            <div *ngIf="editarFoto == false; else cambiar">
                <button class="buttonEditFoto" (click)="editPhoto()">Editar Foto/Tierra</button>
            </div>
            <ng-template #cambiar>
                <button type="button" class="buttonSaveFoto" (click)="editPhoto()">Guardar cambios </button>
            </ng-template>
        </div>

        <div *ngIf="modal == false; else viewModal" class="container2">
            <div class="tituloPerfil">
                <h1 id="titulo">Perfil</h1>
                <img src="../../../assets/images/iconos/cartas.png" alt="">
            </div>
    
            <div class="modificarPerfil">
                
                <div class="editTitle">
                    <h2 id="title2">Modificar perfil</h2>
                    <hr id="line2">
                </div>
    
                <!-- *NOTE - AÑADIR VALIDACIONES A LA VISTA + maxlength en name -->
                <form [formGroup]="editForm" class="editForm">
                   
                    <input type="text" name="user" id="user" placeholder="Nombre de usuario" 
                    formControlName="name"
                    [style.borderColor]="user.marco == this.marcos[1] ? '#28669F' :
                                user.marco == this.marcos[2] ? '#643D6A':
                                user.marco == this.marcos[3] ? '#B6281A':
                                user.marco == this.marcos[4] ? '#5C724B':''"
                    [ngClass]="{
                    'is-invalid': !editForm.get('name').valid,
                    'is-valid': editForm.get('name').valid}">

                    <div *ngIf="!editForm.get('name').valid && editForm.get('name').errors?.maxlength" class="invalid-feedback m-0 text-center fw-bold">
                        Nombre demasiado largo
                    </div>
                    
                    <input type="email" name="email" id="email" placeholder="Correo electrónico" 
                    formControlName="email"
                    
                    [style.borderColor]="user.marco == this.marcos[1] ? '#28669F' :
                    user.marco == this.marcos[2] ? '#643D6A':
                    user.marco == this.marcos[3] ? '#B6281A':
                    user.marco == this.marcos[4] ? '#5C724B':''"
                    
                    [ngClass]="{
                    'is-invalid': !editForm.get('email').valid ||editForm.get('email').hasError('email'),
                    'is-valid': editForm.get('email').valid}">

                    <div *ngIf="editForm.get('email').errors?.email"
                        class="invalid-feedback m-0 text-center fw-bold">
                        El email no es correcto
                    </div>
                 
                    <textarea name="description" id="description" cols="1" rows="4" placeholder="Añade aquí tu descripción" 
                    formControlName="description"
                    [style.borderColor]="user.marco == this.marcos[1] ? '#28669F' :
                    user.marco == this.marcos[2] ? '#643D6A':
                    user.marco == this.marcos[3] ? '#B6281A':
                    user.marco == this.marcos[4] ? '#5C724B':''"
                    [ngClass]="{
                        'is-invalid': !editForm.get('description').valid,
                        'is-valid': editForm.get('description').valid}">
                    </textarea>

                    <div *ngIf="!editForm.get('description').valid && editForm.get('description').errors?.maxlength" class="invalid-feedback m-0 text-center fw-bold">
                        Descripción demasiado larga
                    </div>
                    
                    <input type="password" name="password" id="password" placeholder="Nueva Contraseña" 
                    formControlName="password"
                    [style.borderColor]="user.marco == this.marcos[1] ? '#28669F' :
                    user.marco == this.marcos[2] ? '#643D6A':
                    user.marco == this.marcos[3] ? '#B6281A':
                    user.marco == this.marcos[4] ? '#5C724B':''"
                    [ngClass]="{
                        'is-invalid': !editForm.get('password').valid,
                        'is-valid': editForm.get('password').valid}"
                    >
                    <div *ngIf="!editForm.get('password').valid && editForm.get('password').errors?.minlength" class="invalid-feedback m-0 text-center fw-bold">
                        La contraseña debe contener mínimo 8 caracteres
                    </div>
          
                    
                    <input type="password" name="password2" id="password2" placeholder="Repite Contraseña" 
                    formControlName="password2"
                    [style.borderColor]="user.marco == this.marcos[1] ? '#28669F' :
                    user.marco == this.marcos[2] ? '#643D6A':
                    user.marco == this.marcos[3] ? '#B6281A':
                    user.marco == this.marcos[4] ? '#5C724B':''"
                    [ngClass]="{
                        'is-invalid': !editForm.get('password2').valid,
                        'is-valid': editForm.get('password2').valid}">

                    <div *ngIf="!editForm.get('password2').valid && editForm.get('password2').errors?.noMatch" class="invalid-feedback m-0 text-center fw-bold">
                        Las contraseñas no coinciden
                    </div>
                        
                    <div *ngIf="editar == false; else guardar">
                        <button type="button" class="editButton" (click)="edit()">Editar</button>
                    </div>
    
                    <ng-template #guardar>
                        <button type="button" [ngClass]="editar == true ? 'saveButton': ''" [disabled]="!editForm.valid" (click)="edit()">Guardar Cambios</button>
                    </ng-template>
    
                </form>
            </div>
        </div>
      
        <ng-template #viewModal>
            <app-modal-profile (eventoAvatar) = seleccionAvatar($event) (eventoTierra) = seleccionTierra($event)></app-modal-profile>
        </ng-template>
    </section>
</main>